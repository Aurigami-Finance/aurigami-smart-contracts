import {BigNumber, BigNumber as BN, BigNumberish, constants} from 'ethers';
import {GlobalConfig, InterestRateConfig, TokenConfig} from './type';

function toExp(p: BigNumberish, q: BigNumberish = 1) {
  return EXP_ONE.mul(p).div(q);
}

const ZERO = constants.Zero;
export const EXP_ONE = constants.WeiPerEther;
const ONE_PLY = EXP_ONE;
const TWO_WEEKS = BN.from(24 * 3600).mul(14);
const INITIAL_PLY_REWARD_SPEED = BigNumber.from(1); // dummy reward
export const FINAL_PLY_REWARD_SPEED = ONE_PLY.mul('330687830687831').div(BN.from(10).pow(14)); // 2.75573192 PLY per second

const ONE_PERCENT = toExp(1, 100);
const SEIZE_SHARE_3_PERCENT = ONE_PERCENT.mul(3);

let interestRateModel: InterestRateConfig = {
  BASE_RATE: toExp(2, 100), // 0.02e18
  NORMAL_MULTIPLIER: toExp(10, 100), // 0.1e18
  JUMP_MULTIPLIER: toExp(109, 100), // 1.09e18
  KINK: toExp(80, 100), // 0.8e18
};

// let ply: TokenConfig = {
//   name: 'PLY',
//   address: ADDRESS_ZERO, // will be deployed together with script
//   BORROW_CAP: BN.from(1), // 1 wei in case script forgets to disable borrowing
//   COLLATERAL_FACTOR: ZERO, // 0. Initially there will be no PLY collateral
//   RESERVE_FACTOR: ONE_PERCENT.mul(20),
//   SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
//   AURORA_REWARD_LEND_SPEED: ZERO,
//   AURORA_REWARD_BORROW_SPEED: ZERO,
//   PLY_REWARD_LEND_SPEED: ZERO, // no PLY reward as well (only for PLY)
//   PLY_REWARD_BORROW_SPEED: ZERO, // no PLY reward as well (only for PLY)
//   UNDERLYING_DECIMAL: 18,
//   MAINNET_BACKUP_FEED: 'na',
//   TESTNET_BACKUP_FEED: 'na',
// };

export let usdc: TokenConfig = {
  name: 'USDC',
  address: '0xb12bfca5a55806aaf64e99521918a4bf0fc40802',
  BORROW_CAP: ZERO, // unlimited
  COLLATERAL_FACTOR: ONE_PERCENT.mul(80), // 80%
  RESERVE_FACTOR: ONE_PERCENT.mul(15), // 15%
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: INITIAL_PLY_REWARD_SPEED, // 10.33399471 PLY per second
  PLY_REWARD_BORROW_SPEED: INITIAL_PLY_REWARD_SPEED, // 10.33399471 PLY per second
  UNDERLYING_DECIMAL: 6,
  MAINNET_BACKUP_FEED: '0xdD170e697d7ADed472a9284f07576c3449284502',
  TESTNET_BACKUP_FEED: '0xF0935caaF5FE7f7D5a295Ea3c015e79E1f929b4E',
};

export let eth: TokenConfig = {
  name: 'ETH',
  address: '',
  BORROW_CAP: ZERO, // unlimited
  COLLATERAL_FACTOR: ONE_PERCENT.mul(70), // 70%
  RESERVE_FACTOR: ONE_PERCENT.mul(25), // 25%
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: INITIAL_PLY_REWARD_SPEED,
  PLY_REWARD_BORROW_SPEED: INITIAL_PLY_REWARD_SPEED,
  UNDERLYING_DECIMAL: 18,
  MAINNET_BACKUP_FEED: '0x842AF8074Fa41583E3720821cF1435049cf93565',
  TESTNET_BACKUP_FEED: '0x842AF8074Fa41583E3720821cF1435049cf93565',
};

export let wbtc: TokenConfig = {
  name: 'WBTC',
  address: '0xf4eb217ba2454613b15dbdea6e5f22276410e89e',
  BORROW_CAP: ZERO, // unlimited
  COLLATERAL_FACTOR: ONE_PERCENT.mul(60), // 0.6e18 = 60%
  RESERVE_FACTOR: ONE_PERCENT.mul(30), // 0.3e18 = 30%
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: INITIAL_PLY_REWARD_SPEED,
  PLY_REWARD_BORROW_SPEED: INITIAL_PLY_REWARD_SPEED,
  UNDERLYING_DECIMAL: 8,
  MAINNET_BACKUP_FEED: '0xBE46e430d336fC827d096Db044cBaEECE72e17bC',
  TESTNET_BACKUP_FEED: '0x805215466b012Eb1a5721a22Be2AD5f250beff8a',
};

export let usdt: TokenConfig = {
  name: 'USDT',
  address: '0x4988a896b1227218e4a686fde5eabdcabd91571f',
  BORROW_CAP: ZERO, // unlimited
  COLLATERAL_FACTOR: ONE_PERCENT.mul(70), // 0.7e18 = 70%
  RESERVE_FACTOR: ONE_PERCENT.mul(20), // 0.2e18 = 20%
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: INITIAL_PLY_REWARD_SPEED,
  PLY_REWARD_BORROW_SPEED: INITIAL_PLY_REWARD_SPEED,
  UNDERLYING_DECIMAL: 6,
  MAINNET_BACKUP_FEED: '0x55b9eD56737B161677dC5146873E643647Ba5a43',
  TESTNET_BACKUP_FEED: '0xB39708cadB18324f08e012CB1f017862c5afA2D0',
};

export let dai: TokenConfig = {
  name: 'DAI',
  address: '0xe3520349f477a5f6eb06107066048508498a291b',
  BORROW_CAP: ZERO, // unlimited
  COLLATERAL_FACTOR: ONE_PERCENT.mul(80), // 0.8e18 = 80%
  RESERVE_FACTOR: ONE_PERCENT.mul(15), // 0.15e18 = 15%
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: INITIAL_PLY_REWARD_SPEED,
  PLY_REWARD_BORROW_SPEED: INITIAL_PLY_REWARD_SPEED,
  UNDERLYING_DECIMAL: 18,
  MAINNET_BACKUP_FEED: '0x9e3C7532d9E4bfF3298a132101Bcc62576D80e36',
  TESTNET_BACKUP_FEED: '0x2a3bb4ffbFcb6C7316b3a9bfb8Ac4CEFE5bfc6a6',
};

export let wnear: TokenConfig = {
  name: 'WNEAR',
  address: '0xC42C30aC6Cc15faC9bD938618BcaA1a1FaE8501d',
  BORROW_CAP: ZERO, // unlimited
  COLLATERAL_FACTOR: ONE_PERCENT.mul(60), // 0.6e18 = 60%
  RESERVE_FACTOR: ONE_PERCENT.mul(25), // 0.25e18 = 25%
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: INITIAL_PLY_REWARD_SPEED,
  PLY_REWARD_BORROW_SPEED: INITIAL_PLY_REWARD_SPEED,
  UNDERLYING_DECIMAL: 24,
  MAINNET_BACKUP_FEED: '0x79c57C246794606c83AB32dc56e5cD2030FB552b',
  TESTNET_BACKUP_FEED: '0x0a13BC1F3C441BCB165e8925Fe3E27d18d1Cd66C',
};

export let stnear: TokenConfig = {
  name: 'STNEAR',
  address: '0x07f9f7f963c5cd2bbffd30ccfb964be114332e30',
  BORROW_CAP: BN.from(1), // not applicable
  COLLATERAL_FACTOR: BN.from(0), // zero collateral factor
  RESERVE_FACTOR: BN.from(0), // not applicable
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: BN.from(0),
  PLY_REWARD_BORROW_SPEED: BN.from(0),
  UNDERLYING_DECIMAL: 24,
  MAINNET_BACKUP_FEED: constants.AddressZero,
  TESTNET_BACKUP_FEED: constants.AddressZero,
};

export let aurora: TokenConfig = {
  name: 'AURORA',
  address: '0x8bec47865ade3b172a928df8f990bc7f2a3b9f79',
  BORROW_CAP: BN.from(1), // not applicable
  COLLATERAL_FACTOR: BN.from(0), // zero collateral factor
  RESERVE_FACTOR: BN.from(0), // not applicable
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: BN.from(0),
  PLY_REWARD_BORROW_SPEED: BN.from(0),
  UNDERLYING_DECIMAL: 18,
  MAINNET_BACKUP_FEED: constants.AddressZero,
  TESTNET_BACKUP_FEED: constants.AddressZero,
};

export let tri: TokenConfig = {
  name: 'TRI',
  address: '0xFa94348467f64D5A457F75F8bc40495D33c65aBB',
  BORROW_CAP: BN.from(1), // not applicable
  COLLATERAL_FACTOR: BN.from(0), // zero collateral factor
  RESERVE_FACTOR: BN.from(0), // not applicable
  SEIZE_SHARE: SEIZE_SHARE_3_PERCENT,
  AURORA_REWARD_LEND_SPEED: ZERO,
  AURORA_REWARD_BORROW_SPEED: ZERO,
  PLY_REWARD_LEND_SPEED: BN.from(0),
  PLY_REWARD_BORROW_SPEED: BN.from(0),
  UNDERLYING_DECIMAL: 18,
  MAINNET_BACKUP_FEED: constants.AddressZero,
  TESTNET_BACKUP_FEED: constants.AddressZero,
};

const GOVERNANCE_MULTISIG_TESTNET: string = '0xb969526EBc8dd4b1d816Da846eE08180515fFBbC';
export const testnetDeployConfig: GlobalConfig = {
  IS_MAINNET: false,
  AURORA_ADDRESS: '0x8bec47865ade3b172a928df8f990bc7f2a3b9f79',
  GOVERNANCE_MULTISG: GOVERNANCE_MULTISIG_TESTNET,
  REWARD_CLAIM_START: BN.from(Math.floor(Date.now() / 1000)).add(TWO_WEEKS), // 2 weeks after deployment
  CLOSE_FACTOR: ONE_PERCENT.mul(50), // 0.5e18 = 50%
  LIQUIDATION_INCENTIVE: ONE_PERCENT.mul(110), // 0.1e18 = 110%
  MAX_ASSET: 4,
  TOKENS: [usdc, eth, wbtc, usdt, dai, wnear],
  BORROW_CAP_GUARDIAN: GOVERNANCE_MULTISIG_TESTNET,
  PAUSE_GUARDIAN: GOVERNANCE_MULTISIG_TESTNET,
  ORACLE: '0xAc99efFDF7a8934e35Ad13880D25127c548A7e6d',
  INTEREST_RATE_MODEL: interestRateModel,
  EXPORT_FILENAME: 'aurora_testnet.json',
  updator1: '0x20528f9d3d5B973D95eef64Bb2Fe8DecDBd62B22',
  updator2: '0x549436e3b0273221767E1c65466c447bF59849b1',
  updator3: '0x00Ac4581f67864a6b6561B8160CD4301f9E79F2B',
};

const GOVERNANCE_MULTISIG_MAINNET: string = '0x2D05FfFE70CE64c5954710D4C308dB31C8dBd8dE';
export const mainnetDeployConfig: GlobalConfig = {
  IS_MAINNET: true,
  AURORA_ADDRESS: '0x8bec47865ade3b172a928df8f990bc7f2a3b9f79',
  GOVERNANCE_MULTISG: GOVERNANCE_MULTISIG_MAINNET,
  REWARD_CLAIM_START: BN.from(Math.floor(Date.now() / 1000)).add(TWO_WEEKS.mul(2)),
  CLOSE_FACTOR: ONE_PERCENT.mul(50), // 0.5e18 = 50%
  LIQUIDATION_INCENTIVE: ONE_PERCENT.mul(110), // 0.1e18 = 110%
  MAX_ASSET: 7,
  TOKENS: [usdc, eth, wbtc, usdt, dai, wnear],
  BORROW_CAP_GUARDIAN: GOVERNANCE_MULTISIG_MAINNET,
  PAUSE_GUARDIAN: GOVERNANCE_MULTISIG_MAINNET,
  INTEREST_RATE_MODEL: interestRateModel,
  ORACLE: '0xC6e5185438e1730959c1eF3551059A3feC744E90',
  EXPORT_FILENAME: 'aurora_mainnet.json',
  updator1: '0xf2B7e347Ca4eC2a0F139B1D3073d679911295a2a',
  updator2: '0xb3072378821cdaFAc340bF18a0Fbf15c72FEb83B',
  updator3: '0xF2f3776B9F69A9302c897AEc26b59027e01D36Cc',
};
